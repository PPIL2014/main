<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <link href="default.css" rel="stylesheet" type="text/css"></link>
        <title>Date Roulette</title>
        <script type="text/javascript">

            function afficheFormulaire(xhr, status, args) {
                if (!args.ok)
                    return;

                if (args.copain != null)
                    document.getElementById('formulaire').innerHTML = args.copain + ' veut chatter !' + '<a href="chat.xhtml">CHAT</a>';
            }
        </script>

    </h:head>
    <h:body>
        <div id="wrapper">
            <div id="header-wrapper">
                <div id="header">
                    <div id="logo">
                        <h1><a href="#">DateRoulette</a></h1>
                    </div>
                </div>
            </div>
            <div id="menu-wrapper">
                <div id="menu" >
                    <ul>
                        <li><h:form rendered="false"><h:commandLink value="Ma page" action="profil.xhtml"></h:commandLink></h:form></li>
                        <li><h:form rendered="false"><h:commandLink value="Contact" action="listeAmis.xhtml"></h:commandLink></h:form></li>
                        <li><h:form rendered="false"><h:commandLink value="Messagerie" action="profil.xhtml"></h:commandLink></h:form></li>
                        <li><h:form rendered="false"><h:commandLink value="Deconnexion" action="#{sessionBean.deconnecter()}"></h:commandLink></h:form></li>	
                    </ul>
                </div>
                <!-- end #menu --> 
            </div>
            <div id="page" class="container">
                <h1><h:outputText id="pseudo" value="#{profilBean.utilisateurSession.pseudo}"></h:outputText></h1>
                <h:graphicImage value="#{profilBean.urlAvatar}" width="144px" height="144px"/>
                <br /><br />

                <table>

                    <tr>
                        <td>
                            <b>Nom : </b>
                        </td>
                        <td>
                            <h:outputText id="nom" value="#{profilBean.utilisateurSession.nom}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Prenom : </b>
                        </td>
                        <td> 
                            <h:outputText id="prenom" value="#{profilBean.utilisateurSession.prenom}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Date de naissance : </b>
                        </td>
                        <td>
                            <h:outputText id="ddn" value="#{profilBean.utilisateurSession.ddn.day}/#{profilBean.utilisateur.ddn.month}/#{profilBean.utilisateur.ddn.year}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Sexe : </b>
                        </td>
                        <td>
                            <h:outputText id="sexe" value="#{profilBean.utilisateurSession.sexe}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Adresse : </b>
                        </td>
                        <td>
                            <h:outputText id="adresse" value="#{profilBean.utilisateurSession.adresse}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Mail : </b>
                        </td>
                        <td>
                            <h:outputText id="mail" value="#{profilBean.utilisateurSession.mail}"></h:outputText>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Téléphone :</b>
                        </td>
                        <td>
                            <h:outputText id="telephone" value="#{profilBean.utilisateurSession.telephone}"></h:outputText>
                        </td>
                    </tr>
                </table>

                <table>
                    <h:form>
                        <tr>
                            <td colspan="1">
                                <h:commandButton value="Modifier" action="editProfil">
                                </h:commandButton>
                            </td>
                        </tr>
                    </h:form>

                </table>
                <br />
                <table>
                    <tr>
                        <td>
                            <h:outputLink value="listeAmis.xhtml">
                                <h:outputText value="Liste amis " /> 
                            </h:outputLink>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputLink value="listeNoire.xhtml">
                                <h:outputText value="Liste noire " />  
                            </h:outputLink>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputLink value="listeGaleries.xhtml">
                                <h:outputText value="Liste Galeries " />  
                            </h:outputLink>
                        </td>
                    </tr>
                </table>
                <h:form>

                    <br />
                    <h:commandButton value="CHAT" action="#{chatBean.chatAleatoire}"></h:commandButton>
                    <h:commandButton value="AMIS" action="#{listeAmisBean.afficherAmis}"></h:commandButton>
                    <h:commandButton value="Rechercher des amis" action="#{listeAmisBean.rechercherAmis}"></h:commandButton> 

                    <p:remoteCommand name="nextEvent" actionListener="#{eventProfilBean.lastEvent}" 
                                     oncomplete="updatePage(xhr, status, args);"/> 
                    <script type="text/javascript">
                        updatePage(null, null, null);

                        function updatePage(xhr, status, args) {
                            if (xhr != null)
                            {
                                if (args.ok)
                                {
                                    if (args.type == "goChat")
                                    {
                                        document.location = 'chat.xhtml'
                                        return;
                                    }
                                }
                            }
                            nextEvent();
                        }
                    </script> 
                </h:form>
        
                <div id="formulaire"></div>
    
    <h:form id="myForm">
        <p:remoteCommand name="aUnChat" actionListener="#{profilBean.chatInfo}" 
                         oncomplete="afficheFormulaire(xhr,status,args);" />      
              
        <br/>
        
        <h:commandButton id="btnGoChat" value="Hidden" action="#{chatBean.goChat}" style="display:none">
            <f:ajax execute="@form" render=""></f:ajax>
        </h:commandButton>
        <br/>
        <h:commandButton value="Deconnexion" action="#{sessionBean.deconnecter()}"></h:commandButton>
        <h:commandButton value="Messagerie Privé" action="#{sessionBean.Messagerie()}"></h:commandButton>
        <br/>
        <hr/>
        <br/>
        
        <br/>Liste des utilisateurs connectée : <br/>
        <h:dataTable value="#{sessionBean.listeUtilisateurConnecte}" var="item">
            <h:column>            
                <h:outputText value="#{item}"/><br/>
            </h:column>
        </h:dataTable>
        
        <br/>Liste des utilisateurs en attente : <br/>
        <h:dataTable value="#{profilBean.listeUtilisateurAttente}" var="item">
            <h:column>            
                <h:outputText value="#{item.pseudo}"/><br/>
            </h:column>
        </h:dataTable>
        <br/>
        
    </h:form>
   
    <c:if test="#{profilBean.seulEnAttente}">
        <h:outputText value="Vous êtes seul en attente! Vous serrez redirigé quand quelqu'un arrivera" style="color:#FFCC00;font-size:36px;" />
    </c:if>


            </div>
        </div>

        <div id="footer-wrapper">
            <div id="footer">
                <ul>
                    <li><a href="#">CGU</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Contactez-nous</a></li>
                </ul>
            </div>
        </div>
        <br />

    </h:body>
</html>

